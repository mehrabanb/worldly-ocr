head	1.41;
access;
symbols;
locks; strict;
comment	@// @;


1.41
date	2019.04.13.22.49.43;	author marek;	state Exp;
branches;
next	1.40;

1.40
date	2019.04.13.22.49.31;	author marek;	state Exp;
branches;
next	1.39;

1.39
date	2019.04.13.22.49.18;	author marek;	state Exp;
branches;
next	1.38;

1.38
date	2019.04.13.22.48.57;	author marek;	state Exp;
branches;
next	1.37;

1.37
date	2019.04.13.22.48.29;	author marek;	state Exp;
branches;
next	1.36;

1.36
date	2019.04.13.22.48.03;	author marek;	state Exp;
branches;
next	1.35;

1.35
date	2019.04.13.22.06.23;	author marek;	state Exp;
branches;
next	1.34;

1.34
date	2019.04.13.22.05.55;	author marek;	state Exp;
branches;
next	1.33;

1.33
date	2019.04.13.22.05.11;	author marek;	state Exp;
branches;
next	1.32;

1.32
date	2019.04.13.22.04.44;	author marek;	state Exp;
branches;
next	1.31;

1.31
date	2019.04.13.22.03.07;	author marek;	state Exp;
branches;
next	1.30;

1.30
date	2019.04.13.13.54.43;	author marek;	state Exp;
branches;
next	1.29;

1.29
date	2019.04.13.13.52.35;	author marek;	state Exp;
branches;
next	1.28;

1.28
date	2019.04.13.03.44.40;	author marek;	state Exp;
branches;
next	1.27;

1.27
date	2019.04.13.03.35.02;	author marek;	state Exp;
branches;
next	1.26;

1.26
date	2019.04.13.03.31.47;	author marek;	state Exp;
branches;
next	1.25;

1.25
date	2019.04.13.03.31.41;	author marek;	state Exp;
branches;
next	1.24;

1.24
date	2019.04.13.03.27.09;	author marek;	state Exp;
branches;
next	1.23;

1.23
date	2019.04.13.03.20.15;	author marek;	state Exp;
branches;
next	1.22;

1.22
date	2019.04.13.03.18.54;	author marek;	state Exp;
branches;
next	1.21;

1.21
date	2019.04.13.03.17.50;	author marek;	state Exp;
branches;
next	1.20;

1.20
date	2019.04.13.03.02.56;	author marek;	state Exp;
branches;
next	1.19;

1.19
date	2019.04.13.03.02.48;	author marek;	state Exp;
branches;
next	1.18;

1.18
date	2019.04.13.03.00.53;	author marek;	state Exp;
branches;
next	1.17;

1.17
date	2019.04.13.02.58.51;	author marek;	state Exp;
branches;
next	1.16;

1.16
date	2019.04.13.02.56.11;	author marek;	state Exp;
branches;
next	1.15;

1.15
date	2019.04.13.02.54.29;	author marek;	state Exp;
branches;
next	1.14;

1.14
date	2019.04.13.02.53.45;	author marek;	state Exp;
branches;
next	1.13;

1.13
date	2019.04.13.02.53.37;	author marek;	state Exp;
branches;
next	1.12;

1.12
date	2019.04.13.02.52.58;	author marek;	state Exp;
branches;
next	1.11;

1.11
date	2019.04.13.02.47.10;	author marek;	state Exp;
branches;
next	1.10;

1.10
date	2019.04.13.02.38.33;	author marek;	state Exp;
branches;
next	1.9;

1.9
date	2019.04.13.02.35.47;	author marek;	state Exp;
branches;
next	1.8;

1.8
date	2019.04.13.02.35.17;	author marek;	state Exp;
branches;
next	1.7;

1.7
date	2019.04.13.02.29.05;	author marek;	state Exp;
branches;
next	1.6;

1.6
date	2019.04.13.02.03.47;	author marek;	state Exp;
branches;
next	1.5;

1.5
date	2019.04.13.02.01.08;	author marek;	state Exp;
branches;
next	1.4;

1.4
date	2019.04.13.01.59.57;	author marek;	state Exp;
branches;
next	1.3;

1.3
date	2019.04.13.01.58.02;	author marek;	state Exp;
branches;
next	1.2;

1.2
date	2019.04.13.01.51.47;	author marek;	state Exp;
branches;
next	1.1;

1.1
date	2019.04.13.01.30.35;	author marek;	state Exp;
branches;
next	;


desc
@@


1.41
log
@*** empty log message ***
@
text
@delay=0.02;
chardir='Chars';
bw_chardir='BWChars';
char_count=0;

for page=6:96

    filename=fullfile('Pages',sprintf('page-%02d.ppm',page));
    I1=255-imread(filename);
    I2=im2bw(I1);
    se=strel('square',9);
    I3=imdilate(I2,se);
    %[L,N]=bwlabel(I3,4);
    stats=regionprops(I3,...
                      'BoundingBox',...
                      'MajorAxisLength',...
                      'MinorAxisLength',...
                      'Orientation',...
                      'Image',...
                      'Centroid');
    %stats=sort_stats(stats);
    N=numel(stats);

    %imshow(I3);
    for n=1:N
        if filter_out(stats(n))
            continue;
        end
        J=zeros(size(I2));
        b=stats(n).BoundingBox;
        x1 = b(1); y1 = b(2); x2 = b(1) + b(3); y2 = b(2) + b(4);
        sz = size(I2);
        x1 = round( max(1,x1) ); x2 = round( min(x2, sz(2)));
        y1 = round( max(1,y1) ); y2 = round( min(y2, sz(1)));
        %K=stats(n).Image;
        K = I1( y1:y2, x1:x2 );
        BW = I2( y1 : y2, x1 : x2 );
        BW = imautocrop(BW);
        if filter_image(BW)
            continue
        end
        subplot(1,2,1),
        imagesc(K);
        subplot(1,2,2),
        imagesc(I2);
        r = rectangle('Position',b);
        set(r,'EdgeColor','red');
        title(sprintf('Page %d',page));
        drawnow;
        pause(delay);
        % Save character image
        char_count = char_count +1;
        imwrite(K, fullfile(chardir,sprintf('char%05d.png',char_count)), ...
                'PNG');
        imwrite(BW, fullfile(bw_chardir,sprintf('char%05d.pbm', ...
                                                char_count)),'PBM');
    end

end


function rv=filter_out(stat)
    rv=false;
    if stat.MinorAxisLength ./ stat.MajorAxisLength < 2e-1 && abs(stat.Orientation-90)<5
        rv=true;
    end

end

function rv=filter_image(K)
    rv=false;
    if size(K,1) > 100 || size(K,2) < 10
        rv=true;
    end
end

function sorted=sort_stats(stats)
    C=[stats.Centroid];
    [~, I] = sortrows(C);
    sorted=stats(I);
end@


1.40
log
@*** empty log message ***
@
text
@d55 1
a55 1
        imwrite(BW, fullfile(bw_chardir,sprintf('char%05d.png', ...
@


1.39
log
@*** empty log message ***
@
text
@d55 2
a56 1
        imwrite(BW, fullfile(bw_chardir,sprintf('char%05d.png',char_count)),'PBM');
@


1.38
log
@*** empty log message ***
@
text
@d55 1
a55 1
        imwrite(BW, fullfile(bw_chardir,sprintf('char%05d.png',char_count)),'PNG');
@


1.37
log
@*** empty log message ***
@
text
@d53 3
a55 1
        imwrite(K, fullfile(chardir,sprintf('char%05d.png',char_count)),'PNG');
@


1.36
log
@*** empty log message ***
@
text
@d3 1
@


1.35
log
@*** empty log message ***
@
text
@d52 1
a52 1
        imwrite(K, fullfile(chardir,sprintf('char%d.png',char_count)),'PNG');
@


1.34
log
@*** empty log message ***
@
text
@d52 1
a52 1
        imwrite(K, fullfile(chardir,sprintf('char%d.png',char_count),'PNG'));
@


1.33
log
@*** empty log message ***
@
text
@d52 1
a52 1
        imwrite(K,fullfile(chardir,sprintf('char%d.png',char_count),'PNG');
@


1.32
log
@*** empty log message ***
@
text
@d3 1
a3 1
charnum=0;
d51 2
a52 2
        charnum = charnum +1;
        imwrite(K,fullfile(chardir,sprintf('char%d.png',charnum),'PNG');
@


1.31
log
@*** empty log message ***
@
text
@d3 1
d51 2
a52 1
        imwrite(K,fullfile(chardir,sprintf('char%d,png')),'PNG');
@


1.30
log
@*** empty log message ***
@
text
@d2 1
d49 2
@


1.29
log
@*** empty log message ***
@
text
@d1 1
a1 1
delay=0;
@


1.28
log
@*** empty log message ***
@
text
@d1 1
a1 1
delay=.1;
@


1.27
log
@*** empty log message ***
@
text
@d18 1
a18 1
    stats=sort_stats(stats);
@


1.26
log
@*** empty log message ***
@
text
@d18 1
a18 1
    %stats=sort_stats(stats);
@


1.25
log
@*** empty log message ***
@
text
@d18 1
a18 1
    stats=sort_stats(stats);
@


1.24
log
@*** empty log message ***
@
text
@d16 2
a17 1
                      'Image');
d69 3
a71 2
    

@


1.23
log
@*** empty log message ***
@
text
@d11 7
a17 1
    stats=regionprops(I3,'BoundingBox','MajorAxisLength','MinorAxisLength','Orientation','Image');
d65 5
@


1.22
log
@*** empty log message ***
@
text
@d27 2
a28 2
        B@@ = I2( y1:y2, x1:x2 );
        BW=imautocrop(BW);
@


1.21
log
@*** empty log message ***
@
text
@d21 1
a21 1
        x1=b(1); y1=b(2); x2=b(1)+b(3); y2=b(2)+b(4);
@


1.20
log
@*** empty log message ***
@
text
@d20 5
a24 1
        b=round(stats(n).BoundingBox);
d26 2
a27 6
        K=I1( b(2) : (b(2)+b(4)),...
              b(1) : (b(1)+b(3))...
              );
        BW=I2( b(2) : (b(2)+b(4)),...
               b(1) : (b(1)+b(3))...
               );
@


1.19
log
@*** empty log message ***
@
text
@d29 1
a29 1
        if filter_image(K)
@


1.18
log
@*** empty log message ***
@
text
@d25 4
a28 1
        K=imautocrop(K);
@


1.17
log
@*** empty log message ***
@
text
@d22 1
a22 1
        K=I2( b(2) : (b(2)+b(4)),...
@


1.16
log
@*** empty log message ***
@
text
@d25 1
a52 1
    K=imautocrop(K);
@


1.15
log
@*** empty log message ***
@
text
@d52 1
@


1.14
log
@*** empty log message ***
@
text
@d52 1
a52 1
    if size(K,1) > 100 && size(K,2) < 10
@


1.13
log
@*** empty log message ***
@
text
@d52 1
a52 1
    if size(K,1) > 50 && size(K,2) < 10
@


1.12
log
@*** empty log message ***
@
text
@d52 1
a52 1
    if size(K,1) > 50 && size(K,2) < 5
@


1.11
log
@*** empty log message ***
@
text
@d25 3
d48 7
@


1.10
log
@*** empty log message ***
@
text
@d41 1
a41 1
    if stat.MinorAxisLength ./ stat.MajorAxisLength < 1e-1
@


1.9
log
@*** empty log message ***
@
text
@d41 1
a41 1
    if stat.MinorAxisLength ./ stat.MajorAxisLength < 1e-2
@


1.8
log
@*** empty log message ***
@
text
@d3 1
a3 1
for page=3:96
d41 1
a41 1
    if stat.MinorAxisLength/stat.MajorAxisLength < 1e-2
@


1.7
log
@*** empty log message ***
@
text
@d16 3
d34 9
@


1.6
log
@*** empty log message ***
@
text
@d3 1
a3 1
for p=3:96
d10 3
a12 1
    [L,N]=bwlabel(I3,4);
d16 6
a21 2
        J=(L==n) .* double(I2);
        [K,B]=imautocrop(J);
d26 1
a26 1
        r = rectangle('Position',B);
@


1.5
log
@*** empty log message ***
@
text
@d22 1
@


1.4
log
@*** empty log message ***
@
text
@d3 22
a24 6
filename=fullfile('Pages','page-12.ppm');
I1=255-imread(filename);
I2=im2bw(I1);
se=strel('square',9);
I3=imdilate(I2,se);
[L,N]=bwlabel(I3,4);
a25 12
%imshow(I3);
for n=1:N
    J=(L==n) .* double(I2);
    [K,B]=imautocrop(J);
    subplot(1,2,1),
    imagesc(K);
    subplot(1,2,2),
    imagesc(I2);
    r = rectangle('Position',B);
    set(r,'EdgeColor','red');
    drawnow;
    pause(delay);
@


1.3
log
@*** empty log message ***
@
text
@d1 2
a13 1
    B
d21 1
a21 1
    pause(2);
@


1.2
log
@*** empty log message ***
@
text
@d13 1
d15 4
@


1.1
log
@Initial revision
@
text
@d6 11
a16 1
imagesc(I3);@
